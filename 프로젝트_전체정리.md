# 🎯 개인화 지역 추천 시스템 - 전체 프로젝트 정리

## 📋 전체 프로세스 개요

```
INPUT: 사용자 프로필 (나이, 소득, 취향)
   ↓
STEP 1: 정적 집단 프로필 생성
   ↓
STEP 2: 실시간 지역 프로필 산출 ⭐
   ↓
STEP 3: 사용자 입력 기반 매칭
   ↓
STEP 4: 최종 추천
   ↓
OUTPUT: 맞춤형 지역 TOP 3 + 추천 이유
```

---

## 📊 STEP 1: 정적 집단 프로필 생성

### **데이터 소스**
- 📁 **서울 시민 카드 데이터** (`data_2/` 폴더)
  - `1.서울시민의 일별 소비지역별(행정동).csv` - 155,895행
  - `6.서울시 내국인 성별 연령대별(행정동별).csv` - 100,101행

### **역할**
- 연령대·성별·업종·지역 단위의 **집단 소비 성향 추출**
- 25개 구별 정적 특성 분석
- 변동계수(CV), 성장률 등 시계열 패턴 분석

---

## 🌐 STEP 2: 실시간 지역 프로필 산출 ⭐

### **데이터 소스**
- 🌐 **서울 열린데이터광장 API** (실시간)
  - API: `citydata_cmrcl` (실시간 상권현황데이터)
  - 업데이트: 실시간 (1시간 단위)

### **API 데이터 구조**

| 카테고리 | 필드 | 설명 |
|---------|------|------|
| **지역 기본정보** | `AREA_NM`, `AREA_CD` | 핫스팟 이름/코드 |
| | `AREA_CMRCL_LVL` | 상권 레벨 (한산한/보통/분주한/바쁜) |
| **지역 결제 정보** | `AREA_SH_PAYMENT_CNT` | 지역 전체 결제 건수 |
| | `AREA_SH_PAYMENT_AMT_MIN/MAX` | 지역 결제금액 범위 |
| **업종별 상세** | `RSB_LRG_CTGR` | 업종 대분류 |
| | `RSB_MID_CTGR` | 업종 중분류 |
| | `RSB_PAYMENT_LVL` | 업종별 결제 레벨 |
| | `RSB_SH_PAYMENT_CNT` | 업종별 결제 건수 |
| | `RSB_SH_PAYMENT_AMT_MIN/MAX` | 업종별 결제금액 |
| | `RSB_MCT_CNT` | 가맹점 수 |
| **인구통계** | `CMRCL_MALE_RATE` / `FEMALE_RATE` | 성별 비율 |
| | `CMRCL_10_RATE` ~ `60_RATE` | 연령대별 비율 |
| | `CMRCL_PERSONAL_RATE` | 개인 결제 비율 |
| | `CMRCL_TIME` | 데이터 갱신 시각 |

---

## 📐 STEP 2: 실시간 지역 점수 산출 공식

### **1️⃣ 상권 활성도 점수** (0-100점)

```python
# 정규화 (전체 지역 대비)
결제건수_점수 = (지역_결제건수 / 최대_결제건수) × 100
결제금액_점수 = (지역_평균금액 / 최대_평균금액) × 100
업종다양성_점수 = (업종수 / 최대_업종수) × 100

# 가중 평균
상권활성도점수 = 결제건수_점수 × 0.4 + 결제금액_점수 × 0.3 + 업종다양성_점수 × 0.3
```

**데이터 필드:**
- `AREA_SH_PAYMENT_CNT` → 결제건수
- `AREA_SH_PAYMENT_AMT_MIN/MAX` → 결제금액
- `RSB_LRG_CTGR` (nunique) → 업종 다양성

**파일 위치:** `analyze_realtime_profiles.py` - 줄 23-76

---

### **2️⃣ 업종 특화 점수** (0-100점)

```python
# 업종별 집중도 계산
각_업종_비율 = (해당업종_결제건수 / 전체_결제건수) × 100

# 최고 특화 업종 선정
특화점수 = max(각_업종_비율)

# 등급 부여
- 특화점수 >= 50% → "강한 트렌드"
- 특화점수 >= 30% → "중간 트렌드"
- 특화점수 < 30%  → "일반 지역"
```

**데이터 필드:**
- `RSB_LRG_CTGR` → 업종 대분류
- `RSB_SH_PAYMENT_CNT` → 업종별 결제건수

**파일 위치:** `analyze_realtime_profiles.py` - 줄 78-114

---

### **3️⃣ 인구통계 점수** (0-200점)

```python
# 연령대별 가중치 적용
연령대_가중치 = {
    '10대이하': 1.0,
    '20대': 1.5,
    '30대': 1.5,
    '40대': 1.2,
    '50대': 1.2,
    '60대이상': 1.0
}

# 가중 점수 계산
인구통계점수 = Σ(각_연령대_비율 × 해당_가중치)
```

**데이터 필드:**
- `CMRCL_10_RATE` ~ `CMRCL_60_RATE` → 연령대별 비율
- `CMRCL_MALE_RATE` / `CMRCL_FEMALE_RATE` → 성별 비율

**파일 위치:** `analyze_realtime_profiles.py` - 줄 116-162

---

### **4️⃣ 종합 지역 점수** (0-100점)

```python
# 인구통계 점수 정규화 (0-200 → 0-100)
정규화_인구통계 = (인구통계점수 / 200) × 100

# 종합 점수 계산
종합점수 = (상권활성도점수 × 0.4) + (특화점수 × 0.3) + (정규화_인구통계 × 0.3)

# 등급 부여
- 종합점수 >= 80 → "매우 활성화 (Hot Zone)"
- 종합점수 >= 60 → "활성화 (Active Zone)"
- 종합점수 >= 40 → "보통 (Normal Zone)"
- 종합점수 < 40  → "비활성 (Low Activity Zone)"
```

**파일 위치:** `analyze_realtime_profiles.py` - 줄 164-203

---

## 📈 STEP 2 점수 가중치 요약

| 지표 | 비중 | API 데이터 필드 | 측정 내용 |
|------|------|----------------|----------|
| **상권 활성도** | 40% | `AREA_SH_PAYMENT_CNT` <br> `AREA_SH_PAYMENT_AMT` <br> `RSB_LRG_CTGR` | 결제건수(40%) + 결제금액(30%) + 업종다양성(30%) |
| **업종 특화도** | 30% | `RSB_SH_PAYMENT_CNT` <br> `RSB_LRG_CTGR` | 최고 업종 집중도 |
| **인구통계** | 30% | `CMRCL_10_RATE` ~ `60_RATE` <br> `CMRCL_MALE/FEMALE_RATE` | 연령대별 가중 점수 |

---

## 🔄 STEP 3: 사용자-지역 매칭

### **매칭 공식**

```
매칭점수 = (인구통계 매칭 × 40%) + (소비패턴 매칭 × 35%) + 
          (소득수준 매칭 × 15%) + (업종선호 매칭 × 10%)
```

### **데이터 흐름**

```
사용자 입력 (나이, 소득, 취향)
   ↓
STEP 1의 집단 프로필과 매칭 (data_2 기반)
   ↓
STEP 2의 실시간 점수와 결합 (API 기반)
   ↓
최종 매칭 점수 산출
```

---

## 🎯 STEP 4: 최종 추천

### **최종 점수 계산**

```
최종점수 = (Level1 지역품질점수 × 0.4) + (Level2 매칭점수 × 0.6)
```

### **출력 형식**

```json
{
  "추천순위": 1,
  "지역명": "강남구",
  "종합점수": 87.5,
  "Level1_점수": 85.2,
  "Level2_매칭점수": 89.1,
  "추천이유": [
    "30대 비율 35.2%로 사용자 연령대와 매우 적합",
    "고소득층 밀집 지역으로 소득 수준 일치",
    "음식·음료 특화 지역으로 선호도 부합"
  ]
}
```

---

## 📁 프로젝트 파일 구조

### **핵심 스크립트**

| 파일 | 역할 | 데이터 소스 |
|------|------|------------|
| `generate_data.py` | data_2 폴더 생성 (STEP 1 데이터) | data_1 → data_2 |
| `analyze_realtime_profiles.py` ⭐ | 실시간 지역 프로필 산출 (STEP 2) | API (citydata_cmrcl) |
| `run_level2_matching.py` | 사용자-지역 매칭 (STEP 3) | data_2 + API 프로필 |
| `personalized_recommendation_system.py` | 최종 추천 (STEP 4) | Level1 + Level2 |

### **API 클라이언트**

| 파일 | 역할 |
|------|------|
| `data_api/api_client.py` | 서울 열린데이터 API 클라이언트 |
| `data_api/fetch_commercial_area_data.py` | 실시간 상권 데이터 수집 |
| `data_api/config.py` | API 키 설정 |

### **출력 파일**

| 파일 | 내용 |
|------|------|
| `outputs/realtime_area_profiles.json` | 실시간 지역 프로필 (STEP 2 결과) |
| `outputs/realtime_area_profiles_summary.csv` | 실시간 점수 요약 |
| `outputs/level2_matching_real_data_results.csv` | 매칭 결과 (STEP 3) |
| `outputs/seoul_25gu_level1_scores.csv` | Level 1 지역 품질 점수 |

---

## 🔧 실행 방법

### **1. API 키 설정**

```bash
# data_api/config.py 파일 수정
SEOUL_OPEN_DATA_API_KEY = "YOUR_ACTUAL_API_KEY"
```

**API 키 발급:**
- 서울 열린데이터광장: https://data.seoul.go.kr
- 서비스: `citydata_cmrcl` (실시간 상권현황데이터)

### **2. 실시간 지역 프로필 생성 (STEP 2)**

```bash
python analyze_realtime_profiles.py
```

**출력:**
- `outputs/realtime_area_profiles.json`
- `outputs/realtime_area_profiles_summary.csv`

### **3. 전체 매칭 시스템 실행 (STEP 3-4)**

```bash
python run_level2_matching.py
```

**출력:**
- `outputs/level2_matching_real_data_results.csv`

### **4. 개인화 추천 (최종)**

```bash
python personalized_recommendation_system.py
```

---

## 💡 핵심 인사이트

### **1. 왜 STEP 2가 중요한가?**

| 구분 | STEP 1 (정적 프로필) | STEP 2 (실시간 프로필) |
|------|---------------------|----------------------|
| 데이터 | 과거 카드 데이터 | **실시간 API 데이터** |
| 갱신 주기 | 월 1회 | **1시간 단위** |
| 특징 | 장기 트렌드 분석 | **현재 상황 반영** |
| 예시 | "강남은 학원 특화 지역" | "지금 강남역 분주함, 20-30대 밀집" |

### **2. 왜 가중치가 다른가?**

**STEP 2 (실시간 지역 평가):**
- 상권활성도 40% ← **현재 얼마나 활발한가?**
- 업종특화도 30% ← **무엇에 특화되었는가?**
- 인구통계 30% ← **누가 주로 이용하는가?**

**STEP 3 (사용자 매칭):**
- 인구통계 40% ← **나이/성별이 가장 중요**
- 소비패턴 35% ← **소비 취향 일치**
- 소득수준 15% ← **경제력 적합도**
- 업종선호 10% ← **취향 반영**

### **3. 데이터 신뢰도**

| 데이터 | 출처 | 신뢰도 | 갱신 |
|--------|------|--------|------|
| data_2 카드 데이터 | 서울시 빅데이터 | ★★★★★ | 월간 |
| API 실시간 데이터 | 서울 열린데이터광장 | ★★★★☆ | 1시간 |
| 소득·소비 데이터 | 공공 API | ★★★★☆ | 분기 |

---

## 📊 실제 사용 예시

### **사용자 입력:**
```json
{
  "나이": 28,
  "성별": "여성",
  "월소득": 3500000,
  "선호업종": ["음식·음료", "패션·뷰티"],
  "취향": "트렌디한 곳"
}
```

### **시스템 처리:**

1. **STEP 1:** data_2에서 "20대 여성" 집단 소비 패턴 추출
2. **STEP 2:** API에서 실시간 핫스팟 점수 계산
   - 강남역: 종합 87.5점 (분주함, 20-30대 64%, 음식·음료 특화)
   - 홍대입구: 종합 85.2점 (바쁨, 20대 42%, 문화 특화)
3. **STEP 3:** 사용자-지역 매칭
   - 강남역 매칭: 89.1점 (연령 일치, 소득 적합)
   - 홍대입구 매칭: 91.3점 (연령 최적, 트렌디 분위기)
4. **STEP 4:** 최종 추천
   - 1위: 홍대입구 (88.6점)
   - 2위: 강남역 (88.2점)

---

## 🎓 학술적 기여

### **1. 하이브리드 추천 시스템**
- 협업 필터링 (집단 프로필) + 컨텐츠 기반 (지역 특성) + 실시간 데이터

### **2. 시계열 + 공간 분석**
- 과거 데이터(data_2) + 실시간 데이터(API) 융합

### **3. 다층 점수 체계**
- Level 1 (객관적 평가) → Level 2 (개인화 매칭) → 최종 점수

---

## 📝 개선 방향

### **단기 (현재 가능)**
1. ✅ API 키 설정 및 실시간 데이터 활성화
2. ✅ 더 많은 핫스팟 추가 (현재 4개 → 20개+)
3. ✅ 가중치 최적화 (A/B 테스트)

### **중기 (추가 개발)**
1. 🔄 시간대별 추천 (낮/밤 패턴 반영)
2. 🔄 날씨·이벤트 연동
3. 🔄 사용자 피드백 학습

### **장기 (연구 확장)**
1. 🚀 딥러닝 모델 적용 (BERT, Transformer)
2. 🚀 그래프 신경망 (지역 간 관계)
3. 🚀 강화학습 (추천 최적화)

---

## 📞 참고 자료

- **서울 열린데이터광장:** https://data.seoul.go.kr
- **API 문서:** https://data.seoul.go.kr/dataList/OA-22385/F/1/datasetView.do
- **프로젝트 GitHub:** (추가 예정)

---

**최종 업데이트:** 2025-12-07  
**버전:** 1.0  
**작성자:** AI 추천시스템 프로젝트 팀



